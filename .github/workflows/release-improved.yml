name: Release and Deploy (Improved)

on:
  push:
    tags:
      - 'v*'

jobs:
  build:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest, windows-latest, macos-latest]
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Get tag name
        run: echo "TAG_NAME=${GITHUB_REF#refs/tags/}" >> $GITHUB_ENV
        shell: bash
      
      # ğŸ”¥ í•µì‹¬: íƒœê·¸ ë²„ì „ì„ package.jsonì— ìë™ ì ìš©
      - name: Update package.json version
        run: |
          # íƒœê·¸ì—ì„œ v ì œê±° (v0.1.7 â†’ 0.1.7)
          VERSION=${TAG_NAME#v}
          
          # package.json ë²„ì „ ì—…ë°ì´íŠ¸
          if [[ "$OSTYPE" == "darwin"* ]]; then
            # macOS
            sed -i '' "s/\"version\": \".*\"/\"version\": \"$VERSION\"/" package.json
          else
            # Linux/Windows Git Bash
            sed -i "s/\"version\": \".*\"/\"version\": \"$VERSION\"/" package.json
          fi
          
          echo "Updated package.json to version $VERSION"
          cat package.json | grep version
        shell: bash
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
      
      # ì´í›„ ë¹Œë“œ ì§„í–‰...