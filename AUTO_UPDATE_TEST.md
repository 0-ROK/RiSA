# 🧪 자동 업데이트 테스트 가이드

## 📋 테스트 시나리오

### 1. 로컬 빌드 테스트

```bash
# 현재 버전으로 빌드
pnpm run build
pnpm run package:mac

# 빌드 결과 확인
ls -la release/
# 다음 파일들이 생성되어야 함:
# - RiSA-0.1.8-mac-x64.dmg
# - RiSA-0.1.8-mac-arm64.dmg
# - RiSA-0.1.8-mac-x64.zip
# - RiSA-0.1.8-mac-arm64.zip
# - latest-mac.yml
```

### 2. GitHub Actions 테스트

#### A. 테스트 빌드 워크플로우

1. 코드 변경 후 main 브랜치에 푸시
2. GitHub → Actions → "빌드 테스트" 워크플로우 확인
3. 빌드 성공 여부 확인

#### B. 릴리즈 워크플로우 테스트

```bash
# 버전 업데이트
vim package.json  # "version": "0.1.9"

# 커밋 및 태그
git add .
git commit -m "chore: bump to v0.1.9"
git tag v0.1.9
git push origin main --tags

# GitHub Actions 확인
# 1. Actions 탭에서 워크플로우 실행 확인
# 2. 성공 시 Releases 페이지에 새 릴리즈 생성 확인
```

### 3. 자동 업데이트 기능 테스트

#### A. 기본 업데이트 확인

1. **이전 버전** RiSA 앱 실행
2. 메뉴 → **RiSA** → **업데이트 확인**
3. 다음 시나리오 확인:
   - ✅ "업데이트 사용 가능" 모달 표시
   - ✅ 새 버전 정보 표시
   - ✅ "다운로드" 버튼 동작

#### B. 다운로드 진행률 테스트

1. "다운로드" 버튼 클릭
2. 다음 확인:
   - ✅ "업데이트 다운로드 중" 모달 표시
   - ✅ 진행률 바 동작
   - ✅ 다운로드 속도/용량 표시
   - ✅ 취소 불가능 상태

#### C. 설치 및 재시작 테스트

1. 다운로드 완료 후:
   - ✅ "업데이트 준비 완료" 모달 표시
   - ✅ "지금 재시작" / "나중에" 선택지
2. "지금 재시작" 클릭:
   - ✅ 앱 자동 종료
   - ✅ 새 버전으로 자동 재시작
   - ✅ 정보 → 버전 확인

### 4. 오류 시나리오 테스트

#### A. 네트워크 오류

1. 인터넷 연결 차단 후 업데이트 확인
2. 적절한 오류 메시지 표시 확인

#### B. 다운로드 중단

1. 다운로드 시작 후 네트워크 차단
2. 재시도 또는 오류 처리 확인

#### C. 권한 오류

1. 앱 파일을 읽기 전용으로 설정
2. 설치 권한 오류 처리 확인

## 🔍 디버깅 도구

### 콘솔 로그 확인

```bash
# macOS에서 앱 콘솔 로그 확인
log stream --predicate 'process == "RiSA"' --level debug
```

### 개발자 도구

- 메뉴 → 보기 → 개발자 도구 토글
- Console 탭에서 업데이트 관련 로그 확인

### 업데이트 관련 로그 메시지

```
✅ 정상: "업데이트 확인 중..."
✅ 정상: "업데이트 사용 가능: {version}"
✅ 정상: "다운로드 속도: XXX - 다운로드 XX%"
✅ 정상: "업데이트 다운로드 완료: {version}"

❌ 오류: "업데이트 오류: {error}"
❌ 오류: "네트워크 오류"
```

## 🚨 알려진 문제 및 해결책

### 1. "앱이 손상되었습니다" 오류

```bash
# macOS 보안 속성 제거
xattr -cr /Applications/RiSA.app
```

### 2. 업데이트 서버 연결 실패

- GitHub 서버 상태 확인
- 방화벽/프록시 설정 확인
- DNS 문제 확인

### 3. 권한 부족 오류

- 앱 설치 위치 권한 확인
- 관리자 권한으로 실행 시도

## ✅ 테스트 체크리스트

### 릴리즈 전 필수 확인

- [ ] GitHub Actions 빌드 성공
- [ ] DMG/ZIP 파일 정상 생성
- [ ] latest-mac.yml 메타데이터 정확성
- [ ] 코드 사이닝 (선택사항)
- [ ] 수동 업데이트 확인 기능할
- [ ] 자동 업데이트 알림 UI
- [ ] 다운로드 진행률 표시
- [ ] 재시작 및 설치 프로세스

### 사용자 시나리오 테스트

- [ ] 첫 설치 → 정상 실행
- [ ] 이전 버전 → 새 버전 자동 업데이트
- [ ] 업데이트 거부 → 나중에 다시 알림
- [ ] 네트워크 문제 → 적절한 오류 처리
- [ ] 설치 권한 문제 → 사용자 안내

## 📊 성공 지표

- ✅ **빌드 성공률**: 95% 이상
- ✅ **자동 업데이트 성공률**: 90% 이상
- ✅ **사용자 업데이트 채택률**: 70% 이상 (1주일 내)
- ✅ **오류 발생률**: 5% 미만
